syntax = "proto3";

option java_package = "com.bushpath.doodle.protobuf";
option java_outer_classname = "DoodleProtos";
option java_generate_equals_and_hash = true;

/**
 * Message Type
 */ 

enum MessageType {
    CONTROL_INIT = 0;
    CONTROL_LIST = 1;
    CONTROL_MODIFY = 2;
    CONTROL_SHOW = 3;
    FAILURE = 4;
    GOSSIP = 5;
    PLUGIN_LIST = 6;
    PLUGIN_SHOW = 7;
}

/**
 * Control Messages
 */

message ControlInitRequest {
    string id = 1;
    string plugin = 2;
}

message ControlInitResponse {
}

message ControlListRequest {
}

message ControlListResponse {
    map<string, string> plugins = 1;
}

message ControlModifyRequest {
    string id = 1;
    repeated VariableOperation operations = 2;
}

message ControlModifyResponse {
}

message ControlShowRequest {
    string id = 1;
}

message ControlShowResponse {
    string plugin = 1;    
    repeated PluginVariable variables = 2;
}

/**
 * Gossip Messages
 */

message GossipRequest {
    int32 nodesHash = 1;
    int32 controlPluginsHash = 2;
    int32 sketchPluginsHash = 3;
    map<string, int32> pluginHashes = 4;
}

message GossipResponse {
    repeated Node nodes = 1;
    map<string, string> controlPlugins = 2;
    map<string, string> sketchPlugins = 3;
    map<string, VariableOperations> pluginOperations = 4;
}

/**
 * Plugin Messages
 */

message PluginListRequest {
} 

message PluginListResponse {
    repeated string controlPlugins = 1;
    repeated string sketchPlugins = 2;
}

message PluginShowRequest {
    string plugin = 1;
}

message PluginShowResponse {
    // TODO
}

/**
 * Miscellaneous Messages
 */

message Failure {
    string type = 1;
    string text = 2;
}

message Node {
    int32 id = 1;
    string ipAddress = 2;
    int32 port = 3;
}

message PluginVariable {
    string type = 1;
    string name = 2;
    repeated string values = 3;
}

message VariableOperation {
    int64 timestamp = 1;
    Operation operation = 2;
    PluginVariable variable = 3;

    enum Operation {
        ADD = 0;
        DELETE = 1;
    }
}

message VariableOperations {
    repeated VariableOperation operations = 1;
}
